import Groq from 'groq-sdk';

// Initialize Groq client lazily when needed
let groq = null;
let groqInitialized = false;

function initializeGroq() {
  if (groqInitialized) return groq;
  
  console.log('ЁЯФС Initializing Groq for translation...');
  
  if (process.env.GROQ_API_KEY && process.env.GROQ_API_KEY !== 'your_groq_api_key_here') {
    try {
      groq = new Groq({
        apiKey: process.env.GROQ_API_KEY
      });
      console.log('тЬЕ Groq translation client initialized successfully');
    } catch (error) {
      console.error('тЭМ Failed to initialize Groq translation client:', error);
      groq = null;
    }
  } else {
    console.log('тЭМ Groq API key not configured for translation');
    groq = null;
  }
  
  groqInitialized = true;
  return groq;
}

// Comprehensive language mapping with full names
const LANGUAGE_NAMES = {
  // Major Global Languages
  'en': 'English',
  'zh': 'Chinese (Simplified) - ф╕нцЦЗ(чоАф╜У)',
  'zh-tw': 'Chinese (Traditional) - ф╕нцЦЗ(ч╣БщлФ)',
  'es': 'Spanish - Espa├▒ol',
  'fr': 'French - Fran├зais',
  'ar': 'Arabic - ╪з┘Д╪╣╪▒╪и┘К╪й',
  'pt': 'Portuguese - Portugu├кs',
  'ru': 'Russian - ╨а╤Г╤Б╤Б╨║╨╕╨╣',
  'ja': 'Japanese - цЧецЬмшкЮ',
  'de': 'German - Deutsch',
  
  // Indian Languages
  'hi': 'Hindi - рд╣рд┐рдВрджреА',
  'bn': 'Bengali - ржмрж╛ржВрж▓рж╛',
  'te': 'Telugu - р░др▒Жр░▓р▒Бр░Чр▒Б',
  'mr': 'Marathi - рдорд░рд╛рдареА',
  'ta': 'Tamil - родрооро┐ро┤рпН',
  'gu': 'Gujarati - ркЧрлБркЬрк░рк╛ркдрлА',
  'ur': 'Urdu - ╪з╪▒╪п┘И',
  'kn': 'Kannada - р▓Хр▓ир│Нр▓ир▓б',
  'ml': 'Malayalam - р┤ор┤▓р┤пр┤╛р┤│р┤В',
  'pa': 'Punjabi - рикрй░риЬри╛римрйА',
  
  // European Languages
  'it': 'Italian - Italiano',
  'nl': 'Dutch - Nederlands',
  'pl': 'Polish - Polski',
  'sv': 'Swedish - Svenska',
  'no': 'Norwegian - Norsk',
  'da': 'Danish - Dansk',
  'fi': 'Finnish - Suomi',
  'el': 'Greek - ╬Х╬╗╬╗╬╖╬╜╬╣╬║╬м',
  'cs': 'Czech - ─Мe┼бtina',
  'hu': 'Hungarian - Magyar',
  'uk': 'Ukrainian - ╨г╨║╤А╨░╤Ч╨╜╤Б╤М╨║╨░',
  'bg': 'Bulgarian - ╨С╤К╨╗╨│╨░╤А╤Б╨║╨╕',
  'ro': 'Romanian - Rom├вn─Г',
  'hr': 'Croatian - Hrvatski',
  'sr': 'Serbian - ╨б╤А╨┐╤Б╨║╨╕',
  'sk': 'Slovak - Sloven─Нina',
  'sl': 'Slovenian - Sloven┼б─Нina',
  'et': 'Estonian - Eesti',
  'lv': 'Latvian - Latvie┼бu',
  'lt': 'Lithuanian - Lietuvi┼│',
  
  // Asian Languages
  'ko': 'Korean - эХЬъ╡ньЦ┤',
  'th': 'Thai - р╣Др╕Чр╕в',
  'vi': 'Vietnamese - Tiс║┐ng Viс╗Зt',
  'id': 'Indonesian - Bahasa Indonesia',
  'ms': 'Malay - Bahasa Melayu',
  'tl': 'Filipino - Filipino',
  'my': 'Myanmar - сАЩсА╝сАФсА║сАЩсАм',
  'km': 'Khmer - сЮБсЯТсЮШсЯВсЮЪ',
  'lo': 'Lao - р║ер║▓р║з',
  'si': 'Sinhala - р╖Гр╖Тр╢Вр╖Др╢╜',
  'ne': 'Nepali - рдиреЗрдкрд╛рд▓реА',
  
  // Middle Eastern & Central Asian
  'fa': 'Persian - ┘Б╪з╪▒╪│█М',
  'tr': 'Turkish - T├╝rk├зe',
  'he': 'Hebrew - ╫в╫С╫и╫Щ╫к',
  'az': 'Azerbaijani - Az╔Щrbaycan',
  'ka': 'Georgian - сГесГРсГасГЧсГгсГЪсГШ',
  'hy': 'Armenian - ╒А╒б╒╡╒е╓А╒е╒╢',
  'kk': 'Kazakh - ╥Ъ╨░╨╖╨░╥Ы╤И╨░',
  'ky': 'Kyrgyz - ╨Ъ╤Л╤А╨│╤Л╨╖╤З╨░',
  'uz': 'Uzbek - O╩╗zbekcha',
  
  // African Languages
  'sw': 'Swahili - Kiswahili',
  'am': 'Amharic - сКасИЫсИнсКЫ',
  'yo': 'Yoruba - Yor├╣b├б',
  'ig': 'Igbo - Igbo',
  'ha': 'Hausa - Hausa',
  'zu': 'Zulu - isiZulu',
  'af': 'Afrikaans - Afrikaans',
  'xh': 'Xhosa - isiXhosa',
  'so': 'Somali - Soomaali',
  
  // Latin American
  'pt-br': 'Portuguese (Brazil) - Portugu├кs (Brasil)',
  'es-mx': 'Spanish (Mexico) - Espa├▒ol (M├йxico)',
  'es-ar': 'Spanish (Argentina) - Espa├▒ol (Argentina)',
  'es-co': 'Spanish (Colombia) - Espa├▒ol (Colombia)',
  'es-pe': 'Spanish (Peru) - Espa├▒ol (Per├║)',
  'es-ve': 'Spanish (Venezuela) - Espa├▒ol (Venezuela)',
  'es-cl': 'Spanish (Chile) - Espa├▒ol (Chile)',
  'qu': 'Quechua - Runasimi',
  'gn': 'Guarani - Ava├▒e\'с║╜'
};

// Enhanced mock translations for fallback
const MOCK_TRANSLATIONS = {
  // Major Global Languages
  'zh': '# ЁЯУЛ цЦЗцбгхИЖцЮР\n\n[ш┐ЩцШпф╕Аф╕кф╕нцЦЗч┐╗шпСчд║ф╛Л]\n\n**ц│ицДП**: шжБшО╖х╛ЧчЬЯцнгчЪДч┐╗шпСя╝Мшп╖щЕНч╜оч┐╗шпСцЬНхКбуАВ',
  'zh-tw': '# ЁЯУЛ цЦЗцкФхИЖцЮР\n\n[щАЩцШпф╕АхАЛч╣БщлФф╕нцЦЗч┐╗шнпчд║ф╛Л]\n\n**ц│ицДП**: шжБчН▓х╛ЧчЬЯцнгчЪДч┐╗шнпя╝МшлЛщЕНч╜оч┐╗шнпцЬНхЛЩуАВ',
  'es': '# ЁЯУЛ An├бlisis de Documento\n\n[Esta es una traducci├│n de muestra en espa├▒ol]\n\n**Nota**: Para una traducci├│n real, configure el servicio de traducci├│n.',
  'fr': '# ЁЯУЛ Analyse de Document\n\n[Ceci est un exemple de traduction fran├зaise]\n\n**Note**: Pour une vraie traduction, configurez le service de traduction.',
  'ar': '# ЁЯУЛ ╪к╪н┘Д┘К┘Д ╪з┘Д┘И╪л┘К┘В╪й\n\n[┘З╪░╪з ┘Е╪л╪з┘Д ╪╣┘Д┘Й ╪з┘Д╪к╪▒я┐╜я┐╜┘Е╪й ╪з┘Д╪╣╪▒╪и┘К╪й]\n\n**┘Е┘Д╪з╪н╪╕╪й**: ┘Д┘Д╪н╪╡┘И┘Д ╪╣┘Д┘Й ╪к╪▒╪м┘Е╪й ╪н┘В┘К┘В┘К╪й╪М ┘К╪▒╪м┘Й ╪к┘Г┘И┘К┘Ж ╪о╪п┘Е╪й ╪з┘Д╪к╪▒╪м┘Е╪й.',
  'pt': '# ЁЯУЛ An├бlise de Documento\n\n[Este ├й um exemplo de tradu├з├гo em portugu├кs]\n\n**Nota**: Para uma tradu├з├гo real, configure o servi├зo de tradu├з├гo.',
  'ru': '# ЁЯУЛ ╨Р╨╜╨░╨╗╨╕╨╖ ╨Ф╨╛╨║╤Г╨╝╨╡╨╜╤В╨░\n\n[╨н╤В╨╛ ╨┐╤А╨╕╨╝╨╡╤А ╤А╤Г╤Б╤Б╨║╨╛╨│╨╛ ╨┐╨╡╤А╨╡╨▓╨╛╨┤╨░]\n\n**╨Я╤А╨╕╨╝╨╡╤З╨░╨╜╨╕╨╡**: ╨Ф╨╗╤П ╨╜╨░╤Б╤В╨╛╤П╤Й╨╡╨│╨╛ ╨┐╨╡╤А╨╡╨▓╨╛╨┤╨░ ╨╜╨░╤Б╤В╤А╨╛╨╣╤В╨╡ ╤Б╨╗╤Г╨╢╨▒╤Г ╨┐╨╡╤А╨╡╨▓╨╛╨┤╨░.',
  'ja': '# ЁЯУЛ цЦЗцЫ╕хИЖцЮР\n\n[уБУуВМуБпцЧецЬмшкЮч┐╗ши│уБоуВ╡уГ│уГЧуГлуБзуБЩ]\n\n**ц│ицДП**: хоЯщЪЫуБоч┐╗ши│уБлуБпуАБч┐╗ши│уВ╡уГ╝уГУуВ╣уВТшинхоЪуБЧуБжуБПуБауБХуБДуАВ',
  'de': '# ЁЯУЛ Dokumentenanalyse\n\n[Dies ist ein deutsches ├Ьbersetzungsbeispiel]\n\n**Hinweis**: F├╝r eine echte ├Ьbersetzung konfigurieren Sie den ├Ьbersetzungsdienst.',
  'ko': '# ЁЯУЛ ым╕ьДЬ ы╢ДьДЭ\n\n[ьЭ┤ъ▓ГьЭА эХЬъ╡ньЦ┤ ы▓ИьЧн ьГШэФМьЮЕыЛИыЛд]\n\n**ь░╕ъ│а**: ьЛдьаЬ ы▓ИьЧньЭД ьЬДэХ┤ьДЬыКФ ы▓ИьЧн ьДЬы╣ДьКдые╝ ъ╡мьД▒эХШьД╕ьЪФ.',
  
  // Indian Languages
  'hi': '# ЁЯУЛ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╡рд┐рд╢реНрд▓реЗрд╖рдг\n\n[рдпрд╣ рдПрдХ рд╣рд┐рдВрджреА рдЕрдиреБрд╡рд╛рдж рдирдореВрдирд╛ рд╣реИ]\n\n**рдиреЛрдЯ**: рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЕрдиреБрд╡рд╛рдж рдХреЗ рд▓рд┐рдП, рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВред',
  'bn': '# ЁЯУЛ ржиржерж┐ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг\n\n[ржПржЯрж┐ ржПржХржЯрж┐ ржмрж╛ржВрж▓рж╛ ржЕржирзБржмрж╛ржжрзЗрж░ ржиржорзБржирж╛]\n\n**ржирзЛржЯ**: ржкрзНрж░ржХрзГржд ржЕржирзБржмрж╛ржжрзЗрж░ ржЬржирзНржп, ржЕржирзБржмрж╛ржж рж╕рзЗржмрж╛ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржиред',
  'te': '# ЁЯУЛ р░кр░др▒Нр░░р░В р░╡р░┐р░╢р▒Нр░▓р▒Зр░╖р░г\n\n[р░Зр░жр░┐ р░др▒Жр░▓р▒Бр░Чр▒Б р░Ер░ир▒Бр░╡р░╛р░ж р░ир░ор▒Вр░ир░╛]\n\n**р░Чр░ор░ир░┐р░Х**: р░╡р░╛р░╕р▒Нр░др░╡ р░Ер░ир▒Бр░╡р░╛р░жр░В р░Хр▒Лр░╕р░В, р░Ер░ир▒Бр░╡р░╛р░ж р░╕р▒Зр░╡р░ир▒Б р░Хр░╛р░ир▒Нр░лр░┐р░Чр░░р▒Н р░Ър▒Зр░пр░Вр░бр░┐ред',
  'ta': '# ЁЯУЛ роЖро╡рог рокроХрпБрокрпНрокро╛ропрпНро╡рпБ\n\n[роЗродрпБ родрооро┐ро┤рпН роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ рооро╛родро┐ро░ро┐]\n\n**роХрпБро▒ро┐рокрпНрокрпБ**: роЙрогрпНроорпИропро╛рой роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБроХрпНроХрпБ, роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роЪрпЗро╡рпИропрпИ роХроЯрпНроЯроорпИроХрпНроХро╡рпБроорпНред',
  'gu': '# ЁЯУЛ ркжрк╕рлНркдрк╛рк╡рлЗркЬ рк╡рк┐рк╢рлНрк▓рлЗрк╖ркг\n\n[ркЖ ркЧрлБркЬрк░рк╛ркдрлА ркЕркирлБрк╡рк╛ркжркирлЛ ркиркорлВркирлЛ ркЫрлЗ]\n\n**ркирлЛркВркз**: рк╡рк╛рк╕рлНркдрк╡рк┐ркХ ркЕркирлБрк╡рк╛ркж ркорк╛ркЯрлЗ, ркЕркирлБрк╡рк╛ркж рк╕рлЗрк╡рк╛ ркЧрлЛркарк╡рлЛред',
  'kn': '# ЁЯУЛ р▓жр▓╛р▓Цр▓▓р│Ж р▓╡р▓┐р▓╢р│Нр▓▓р│Зр▓╖р▓гр│Ж\n\n[р▓Зр▓жр│Б р▓Хр▓ир│Нр▓ир▓б р▓Ер▓ир│Бр▓╡р▓╛р▓жр▓ж р▓ор▓╛р▓жр▓░р▓┐]\n\n**р▓╕р│Вр▓Ър▓ир│Ж**: р▓ир▓┐р▓Ьр▓╡р▓╛р▓ж р▓Ер▓ир│Бр▓╡р▓╛р▓жр▓Хр│Нр▓Хр▓╛р▓Чр▓┐, р▓Ер▓ир│Бр▓╡р▓╛р▓ж р▓╕р│Зр▓╡р│Жр▓пр▓ир│Нр▓ир│Б р▓Хр▓╛р▓ир│Нр▓лр▓┐р▓Чр▓░р│Н р▓ор▓╛р▓бр▓┐ред',
  'ml': '# ЁЯУЛ р┤░р╡Зр┤Ц р┤╡р┤┐р┤╢р┤Хр┤▓р┤ир┤В\n\n[р┤Зр┤др╡Н р┤ор┤▓р┤пр┤╛р┤│р┤В р┤╡р┤┐р┤╡р╡╝р┤др╡Нр┤др┤ир┤др╡Нр┤др┤┐р┤ир╡Нр┤▒р╡Ж р┤╕р┤╛р┤ор╡Нр┤кр┤┐р╡╛ р┤Жр┤гр╡Н]\n\n**р┤Хр╡Бр┤▒р┤┐р┤кр╡Нр┤кр╡Н**: р┤пр┤ер┤╛р╡╝р┤др╡Нр┤е р┤╡р┤┐р┤╡р╡╝р┤др╡Нр┤др┤ир┤др╡Нр┤др┤┐р┤ир┤╛р┤пр┤┐, р┤╡р┤┐р┤╡р╡╝р┤др╡Нр┤др┤и р┤╕р╡Зр┤╡р┤ир┤В р┤Хр╡Лр╡║р┤лр┤┐р┤Чр╡╝ р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Хред',
  'mr': '# ЁЯУЛ рджрд╕реНрддрдРрд╡рдЬ рд╡рд┐рд╢реНрд▓реЗрд╖рдг\n\n[рд╣реЗ рдорд░рд╛рдареА рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪреЗ рдирдореБрдирд╛ рдЖрд╣реЗ]\n\n**рдЯреАрдк**: рд╡рд╛рд╕реНрддрд╡рд┐рдХ рднрд╛рд╖рд╛рдВрддрд░рд╛рд╕рд╛рдареА, рднрд╛рд╖рд╛рдВрддрд░ рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛ред',
  'pa': '# ЁЯУЛ рижри╕ридри╛ри╡рйЗриЬри╝ ри╡ри┐ри╕ри╝ри▓рйЗри╕ри╝риг\n\n[риЗри╣ рикрй░риЬри╛римрйА риЕриирйБри╡ри╛риж рижри╛ риириорйВриири╛ ри╣рйИ]\n\n**риирйЛриЯ**: риЕри╕ри▓ риЕриирйБри╡ри╛риж ри▓риИ, риЕриирйБри╡ри╛риж ри╕рйЗри╡ри╛ риирйВрй░ ри╕рй░ри░риЪри┐рид риХри░рйЛред',
  'ur': '# ЁЯУЛ ╪п╪│╪к╪з┘И█М╪▓ ┌й╪з ╪к╪м╪▓█М█Б\n\n[█М█Б ╪з╪▒╪п┘И ╪к╪▒╪м┘Е█Т ┌й╪з ┘Ж┘Е┘И┘Ж█Б █Б█Т]\n\n**┘Ж┘И┘╣**: ╪н┘В█М┘В█М ╪к╪▒╪м┘Е█Т ┌й█Т ┘Д█М█Т╪М ╪к╪▒╪м┘Е█Б ╪│╪▒┘И╪│ ┌й┘И ┌й┘Ж┘Б█М┌п╪▒ ┌й╪▒█М┌║█Ф',
  
  // European Languages
  'it': '# ЁЯУЛ Analisi del Documento\n\n[Questo ├и un esempio di traduzione italiana]\n\n**Nota**: Per una traduzione reale, configurare il servizio di traduzione.',
  'nl': '# ЁЯУЛ Documentanalyse\n\n[Dit is een Nederlandse vertaalvoorbeeld]\n\n**Opmerking**: Voor een echte vertaling, configureer de vertaalservice.',
  'pl': '# ЁЯУЛ Analiza Dokumentu\n\n[To jest przyk┼Вad polskiego t┼Вumaczenia]\n\n**Uwaga**: Aby uzyska─З prawdziwe t┼Вumaczenie, skonfiguruj us┼Вug─Щ t┼Вumaczenia.',
  'sv': '# ЁЯУЛ Dokumentanalys\n\n[Detta ├дr ett svenskt ├╢vers├дttningsexempel]\n\n**Obs**: F├╢r en riktig ├╢vers├дttning, konfigurera ├╢vers├дttningstj├дnsten.',
  'no': '# ЁЯУЛ Dokumentanalyse\n\n[Dette er et norsk oversettelseseksempel]\n\n**Merk**: For en ekte oversettelse, konfigurer oversettelsestjenesten.',
  'da': '# ЁЯУЛ Dokumentanalyse\n\n[Dette er et dansk overs├жttelseseksempel]\n\n**Bem├жrk**: For en ├жgte overs├жttelse, konfigurer overs├жttelsestjenesten.',
  'fi': '# ЁЯУЛ Asiakirja-analyysi\n\n[T├дm├д on suomalainen k├д├дnn├╢sesimerkki]\n\n**Huomautus**: Todellista k├д├дnn├╢st├д varten, m├д├дrit├д k├д├дnn├╢spalvelu.',
  
  // Asian Languages
  'th': '# ЁЯУЛ р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Ар╕нр╕Бр╕кр╕▓р╕г\n\n[р╕Щр╕╡р╣Ир╕Др╕╖р╕нр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕ар╕▓р╕йр╕▓р╣Др╕Чр╕в]\n\n**р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕**: р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Ир╕гр╕┤р╕З р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕│р╕лр╕Щр╕Фр╕Др╣Ир╕▓р╕Ър╕гр╕┤р╕Бр╕▓р╕гр╣Бр╕Ыр╕е',
  'vi': '# ЁЯУЛ Ph├вn t├нch T├аi liс╗Зu\n\n[─Р├вy l├а mс║лu dс╗Лch tiс║┐ng Viс╗Зt]\n\n**L╞░u ├╜**: ─Рс╗Г c├│ bс║гn dс╗Лch thс╗▒c sс╗▒, h├гy cс║еu h├мnh dс╗Лch vс╗е dс╗Лch thuс║нt.',
  'id': '# ЁЯУЛ Analisis Dokumen\n\n[Ini adalah contoh terjemahan bahasa Indonesia]\n\n**Catatan**: Untuk terjemahan yang sebenarnya, konfigurasikan layanan terjemahan.',
  'ms': '# ЁЯУЛ Analisis Dokumen\n\n[Ini adalah contoh terjemahan bahasa Melayu]\n\n**Nota**: Untuk terjemahan sebenar, konfigurasikan perkhidmatan terjemahan.',
  'tl': '# ЁЯУЛ Pagsusuri ng Dokumento\n\n[Ito ay isang halimbawa ng pagsasalin sa Filipino]\n\n**Paalala**: Para sa tunay na pagsasalin, i-configure ang serbisyo ng pagsasalin.',
  
  // Middle Eastern
  'fa': '# ЁЯУЛ ╪к╪н┘Д█М┘Д ╪│┘Ж╪п\n\n[╪з█М┘Ж ┘Ж┘Е┘И┘Ж┘ЗтАМ╪з█М ╪з╪▓ ╪к╪▒╪м┘Е┘З ┘Б╪з╪▒╪│█М ╪з╪│╪к]\n\n**╪к┘И╪м┘З**: ╪и╪▒╪з█М ╪к╪▒╪м┘Е┘З ┘И╪з┘В╪╣█М╪М ╪│╪▒┘И█М╪│ ╪к╪▒╪м┘Е┘З ╪▒╪з ┘╛█М┌й╪▒╪и┘Ж╪п█М ┌й┘Ж█М╪п.',
  'tr': '# ЁЯУЛ Belge Analizi\n\n[Bu bir T├╝rk├зe ├зeviri ├╢rne─Яidir]\n\n**Not**: Ger├зek ├зeviri i├зin ├зeviri hizmetini yap─▒land─▒r─▒n.',
  'he': '# ЁЯУЛ ╫а╫Щ╫к╫Х╫Ч ╫Ю╫б╫Ю╫Ъ\n\n[╫Ц╫Х╫Ф╫Щ ╫У╫Х╫Т╫Ю╫Ф ╫Ь╫к╫и╫Т╫Х╫Э ╫в╫С╫и╫Щ]\n\n**╫Ф╫в╫и╫Ф**: ╫Ь╫к╫и╫Т╫Х╫Э ╫Р╫Ю╫Щ╫к╫Щ, ╫Ф╫Т╫У╫и ╫Р╫к ╫й╫Щ╫и╫Х╫к ╫Ф╫к╫и╫Т╫Х╫Э.',
  
  // African Languages
  'sw': '# ЁЯУЛ Uchambuzi wa Hati\n\n[Hii ni mfano wa tafsiri ya Kiswahili]\n\n**Kumbuka**: Kwa tafsiri halisi, sanidi huduma ya tafsiri.',
  'am': '# ЁЯУЛ сИ░сКРсЛ╡ сЙ╡сКХсЙ░сКУ\n\n[сЛнсИЕ сЛисКасИЫсИнсКЫ сЙ╡сИнсМЙсИЭ сКУсИЩсКУ сКРсЛН]\n\n**сИЫсИ╡сЙ│сЛИсИ╗**: сИИсКесЛНсКРсЙ░сКЫ сЙ╡сИнсМЙсИЭсНг сЛисЙ╡сИнсМЙсИЭ сКасМИсИНсМНсИОсЙ▒сКХ сЛлсЛЛсЙЕсИйсНв',
  'yo': '# ЁЯУЛ ├Мt├║palс║╣╠А ├Мw├й\n\n[├Иy├н ni ├аpс║╣с║╣rс║╣ ├мtumс╗Н╠А Yor├╣b├б]\n\n**├Аk├нy├иs├н**: F├║n ├мtumс╗Н╠А gidi, с╣г├иt├▓ iс╣гс║╣╠Б ├мtumс╗Н╠А.',
  
  // Default fallback
  'default': '# ЁЯУЛ Document Analysis\n\n[Translation service not configured for this language]\n\n**Note**: Please configure the translation service for proper language support.'
};

export async function translateText(text, targetLanguage) {
  console.log('ЁЯМР Translation service called for language:', targetLanguage);
  console.log('ЁЯУЭ Text length to translate:', text.length);
  
  try {
    if (targetLanguage === 'en') {
      console.log('тЬЕ No translation needed for English');
      return text; // No translation needed
    }

    // Initialize Groq client when needed
    const groqClient = initializeGroq();
    
    if (!groqClient) {
      console.log('тЭМ No Groq client available - using mock translation');
      // Use enhanced mock translation
      const mockTranslation = MOCK_TRANSLATIONS[targetLanguage] || MOCK_TRANSLATIONS['default'];
      return mockTranslation.replace('[Translation service not configured for this language]', 
        `[${LANGUAGE_NAMES[targetLanguage] || targetLanguage} translation sample]`);
    }

    const targetLanguageName = LANGUAGE_NAMES[targetLanguage] || targetLanguage;
    
    console.log('ЁЯЪА Calling Groq API for translation to:', targetLanguageName);
    
    const completion = await groqClient.chat.completions.create({
      messages: [
        {
          role: "system",
          content: `You are a professional translator specializing in legal document translation. Translate the given legal document analysis from English to ${targetLanguageName}. 

CRITICAL INSTRUCTIONS:
1. Translate ALL content including headings, bullet points, body text, and technical terms
2. Maintain the exact markdown formatting (headers with #, ##, ###, bullet points with -, numbered lists, etc.)
3. Keep emojis in their original positions
4. Preserve the structure and organization of the document exactly
5. Use natural, fluent ${targetLanguageName} that is appropriate for legal contexts
6. Translate technical legal terms accurately while keeping them understandable
7. Do not add any explanatory notes about the translation process
8. Keep the professional tone and clarity of the original
9. For right-to-left languages (Arabic, Hebrew, Persian, Urdu), maintain proper text direction
10. Use appropriate formal register for the target language

Translate the entire document completely and accurately while preserving all formatting.`
        },
        {
          role: "user",
          content: `Please translate this complete legal document analysis to ${targetLanguageName}:\n\n${text}`
        }
      ],
      model: "llama-3.3-70b-versatile",
      temperature: 0.2,
      max_completion_tokens: 4000,
      top_p: 1,
      stream: false
    });

    const translatedText = completion.choices[0]?.message?.content || text;
    
    console.log('тЬЕ Translation completed successfully');
    console.log('ЁЯУЭ Translated text length:', translatedText.length);
    console.log('ЁЯУЭ Translation preview:', translatedText.substring(0, 200) + '...');
    
    return translatedText;

  } catch (error) {
    console.error('тЭМ Translation Error:', error.message);
    console.error('тЭМ Full translation error:', error);
    
    // Return a fallback translation with error message
    const targetLanguageName = LANGUAGE_NAMES[targetLanguage] || targetLanguage;
    return `# ЁЯУЛ Document Analysis - Translation Error

**Translation Service Error**: Unable to translate to ${targetLanguageName}

**Original Content (English):**

${text}

**Error Details:** ${error.message}

**Note:** Please check the translation service configuration or try again later.`;
  }
}